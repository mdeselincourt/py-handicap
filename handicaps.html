<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Handicap Explorer</title>

  <meta property="og:title" content="Handicap Explorer">
  <meta property="og:type" content="website">
  <meta property="og:description" content="A simple HTML5 Template for new projects.">
  <meta property="og:image" content="image.png">

  <link rel="icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <link rel="stylesheet" href="css/styles.css?v=1.0">

  	<style>
		
		body {
			font-family: 'Montserrat', Arial, Helvetica, sans-serif;
		}
		h1, h2  {color: blue;}	

	</style>

</head>

<body>

<h1>Handicap Explorer</h1>

<table>
        <tr><td>420</td>
        <td><input type="text" id="420" value="1100"/></td></tr>

        <tr><td>420NoSpin</td>
        <td><input type="text" id="420NoSpin" value="1120"/></td></tr>
    
        <tr><td>Enterprise</td>
        <td><input type="text" id="Enterprise" value="1111"/></td></tr>

        <tr><td>GP14</td>
        <td><input type="text" id="GP14" value="1129"/></td></tr>
           
        <tr><td>GP14NoSpin</td>
        <td><input type="text" id="GP14NoSpin" value="1149"/></td></tr>

        <tr><td>Laser</td>
        <td><input type="text" id="Laser" value="1078"/></td></tr>

        <tr><td>Laser13</td>
        <td><input type="text" id="Laser13" value="1135"/></td></tr>

        <tr><td>Laser4.7</td>
        <td><input type="text" id="Laser4.7" value="1174"/></td></tr>

        <tr><td>LaserRadial</td>
        <td><input type="text" id="LaserRadial" value="1111"/></td></tr>
        
        <tr><td>MerlinNoSpin</td>
        <td><input type="text" id="MerlinNoSpin" value="1079"/></td></tr>
        
        <tr><td>Pico</td>
        <td><input type="text" id="Pico" value="1340"/></td></tr>

        <tr><td>Solo</td>
        <td><input type="text" id="Solo" value="1148"/></td></tr>
        
        <tr><td>Streaker</td>
        <td><input type="text" id="Streaker" value="1128"/></td></tr>

        <tr><td>Supernova</td>
        <td><input type="text" id="Supernova" value="1070"/></td></tr>
        
        <tr><td>Xenon</td>
        <td><input type="text" id="Xenon" value="1080"/></td></tr>
            
        <tr><td>XenonNoSpin</td>
        <td><input type="text" id="XenonNoSpin" value="1100"/></td></tr>
        
    </table>
    <p>
        <button onClick="writeClubPYstoForm()">Apply Club PYs</button> <button onClick="writeRYAPYstoForm()">Apply RYA PYs</button>
    </p>

    <p>
        Race type filter
        <select name="raceTypeSelect" id="raceTypeSelect">
            <option value="*">All races</option>
            <option value="L">Local only</option>
            <option value="D">Downriver only</option>
          </select>
    </p>
    

    <p>Because not every class competes in every race, the total win %s will add up to more than 100%.</p>

    <p>Single-class races are not included in the simulation (as the results prove nothing about handicaps)</p>

    <button onClick="calculate()">Calculate</button>

    <p id="summary">...</p>

    </body>

    <script>

        // set defaults
        var PYs = {
                "Laser": 1078,
                "LaserRadial": 1111,
                "Laser4.7": 1174,
                "Solo": 1148,
                "Enterprise": 1111,
                "GP14": 1129,
                "GP14NoSpin": 1149,
                "Xenon": 1080,
                "XenonNoSpin": 1100,
                "420NoSpin": 1120,
                "420": 1100,
                "Supernova": 1070,
                "MerlinNoSpin": 1079,
                "Streaker": 1128,
                "Laser13": 1135,
                "Pico": 1340
            }

            const clubPYs = {
                "Laser": 1078,
                "LaserRadial": 1111,
                "Laser4.7": 1174,
                "Solo": 1148,
                "Enterprise": 1111,
                "GP14": 1129,
                "GP14NoSpin": 1149,
                "Xenon": 1080,
                "XenonNoSpin": 1100,
                "420NoSpin": 1120,
                "420": 1100,
                "Supernova": 1070,
                "MerlinNoSpin": 1079,
                "Streaker": 1128,
                "Laser13": 1135,
                "Pico": 1340
            }

            const RYAPYs = {
                "Laser": 1100,
                "LaserRadial": 1147,
                "Laser4.7": 1208,
                "Solo": 1142,
                "Enterprise": 1122,
                "GP14": 1130,
                "GP14NoSpin": 1149,
                "Xenon": 1079,
                "XenonNoSpin": 1100,
                "420": 1105,
                "420NoSpin": 1120,
                "Supernova": 1077,
                "MerlinNoSpin": 980,
                "Streaker": 1128,
                "Laser13": 1135,
                "Pico": 1330
            }

        function writeClubPYstoForm() {
            console.log("Setting club PYs")
            writePYstoForm(clubPYs)
        }

        function writeRYAPYstoForm() {
            console.log("Setting RYA PYs")
            writePYstoForm(RYAPYs)
        }

        function writePYstoForm(pys) {

            //var rememberSelector = document.getElementById("raceTypeSelect").value
            for (const [cl, ha] of Object.entries(pys)) {
                //console.log("Writing " + cl + " " + ha + " to form")
                var i = document.getElementById(cl)
                i.value = ha
            }
            //document.getElementById("raceTypeSelect").value = rememberSelector
        }

        /*
        Documentation

        This script currently consumes a table of results from MULTICLASS RACES ONLY; for boatwise/sailorwise analysis
        it will need to be modified to tolerate single-class races in the data.

        Firstly it restructure a list of RESULTS into a list of RACES

        */

        function calculate() {
			
			
            // G = Goodwin = Spring
            // B = Bevington = Summar
            // C = Campbell = Autumn

			// AMF Allan
			// JD Jane Deith (Joe Driver)
			// 

            var results = [["B22-0", "L", "Solo", "3663", "1148", "Allan Munro-Faure"],
                ["B22-0", "L", "Laser", "4130", "1078", "Jane Deith"],
                ["B22-0", "L", "Laser", "4880", "1078", "Marco Davanzo"],
                ["B22-0", "L", "Solo", "3521", "1148", "James Channer"],
                ["B22-0", "L", "Laser", "4132", "1078", "Elaine Agius"],
                ["B22-1", "L", "Laser", "5455", "1078", "Eleanor Hanning"],
                ["B22-1", "L", "Laser", "5859", "1078", "Ben Roost"],
                ["B22-1", "L", "LaserRadial", "7005", "1111", "Jane Watkins"],
                ["B22-1", "L", "420", "6383", "1100", "Sina Stapelfeldt"],
                ["B22-1", "L", "Solo", "5165", "1148", "Sara Bennett"],
                ["B22-1", "L", "Laser", "5605", "1078", "Alex Dolea"],
                ["B22-1", "L", "Laser", "4935", "1078", "Henry Cook"],
                ["B22-1", "L", "Laser", "4888", "1078", "Jakob Grunig"],
                ["B22-1", "L", "Laser", "4878", "1078", "Renato Hidalgo"],
                ["B22-1", "L", "Solo", "5000", "1148", "James Channer"],
                ["B22-1", "L", "Solo", "4973", "1148", "Allan Munro-Faure"],
                ["B22-1", "L", "Solo", "5563", "1148", "Peter Mack"],
                ["B22-1", "L", "Laser", "5395", "1078", "Michael de Selincourt"],
                ["B22-2", "L", "Solo", "3274", "1148", "James Channer"],
                ["B22-2", "L", "Supernova", "4213", "1070", "Sebastian Glen"],
                ["B22-2", "L", "Laser", "4518", "1078", "Peter Mack"],
                ["B22-2", "L", "Laser", "3850", "1078", "Eleanor Hanning"],
                ["B22-2", "L", "Solo", "3852", "1148", "Anthony Wort"],
                ["B22-2", "L", "Laser", "3618", "1078", "Jakob Grunig"],
                ["B22-2", "L", "Solo", "3988", "1148", "Sara Bennett"],
                ["B22-2", "L", "Solo", "3177", "1148", "Allan Munro-Faure"],
                ["B22-2", "L", "Laser", "3853", "1078", "John Bengue"],
                ["B22-3", "L", "Laser", "3972", "1078", "Natalia Nielsen"],
                ["B22-3", "L", "Laser", "4540", "1078", "Henry Cook"],
                ["B22-3", "L", "LaserRadial", "4533", "1111", "Sina Stapelfeldt"],
                ["B22-3", "L", "Laser", "4184", "1078", "Eleanor Hanning"],
                ["B22-3", "L", "Laser", "4659", "1078", "Patrick Hughes"],
                ["B22-3", "L", "Laser", "3932", "1078", "Jakob Grunig"],
                ["B22-3", "L", "Solo", "3969", "1148", "Allan Munro-Faure"],
                ["B22-4", "L", "Laser", "3163", "1078", "Jakob Grunig"],
                ["B22-4", "L", "Solo", "3514", "1148", "James Channer"],
                ["B22-4", "L", "Solo", "3515", "1148", "Allan Munro-Faure"],
                ["B22-4", "L", "Solo", "3632", "1148", "Peter Mack"],
                ["B22-4", "L", "Solo", "3635", "1148", "Sara Bennett"],
                ["B22-4", "L", "Laser", "3546", "1078", "Michael de Selincourt"],
                ["B22-4", "L", "Laser13", "4507", "1148", "Jane Deith"],
                ["B22-5", "L", "LaserRadial", "3556", "1111", "Graham Bagnall"],
                ["B22-5", "L", "Laser4.7", "3742", "1174", "Jane Deith"],
                ["B22-5", "L", "Solo", "3164", "1148", "Sebastian Glen"],
                ["B22-5", "L", "Solo", "2607", "1148", "James Channer"],
                ["B22-5", "L", "LaserRadial", "3027", "1111", "Dan Bignold"],
                ["B22-5", "L", "LaserRadial", "3309", "1111", "James Fulford"],
                ["B22-5", "L", "LaserRadial", "2718", "1111", "Henry Cook"],
                ["B22-6", "L", "Laser", "4147", "1078", "Renato Hidalgo"],
                ["B22-6", "L", "Solo", "4158", "1148", "Allan Munro-Faure"],
                ["B22-6", "L", "Solo", "4189", "1148", "Sara Bennett"],
                ["B22-6", "L", "Laser", "4148", "1078", "Alex Dolea"],
                ["B22-6", "L", "Laser", "4429", "1078", "Elaine Agius"],
                ["B22-6", "L", "Laser", "4508", "1078", "John Bengue"],
                ["B22-1", "D", "Solo", "5985", "1148", "Sara Bennett"],
                ["B22-1", "D", "Laser", "6519", "1078", "Andrea Stadelmann"],
                ["B22-1", "D", "Laser", "6070", "1078", "Sina Stapelfeldt"],
                ["B22-1", "D", "Laser", "6255", "1078", "Karin Andreasson"],
                ["B22-1", "D", "Laser", "5403", "1078", "Renato Hidalgo"],
                ["B22-1", "D", "Solo", "5959", "1148", "Allan Munro-Faure"],
                ["B22-2", "D", "Laser", "7764", "1078", "John Salter"],
                ["B22-2", "D", "Solo", "6190", "1148", "Sara Bennett"],
                ["B22-2", "D", "Xenon", "8192", "1080", "Peter Mack"],
                ["B22-2", "D", "Solo", "6031", "1148", "Allan Munro-Faure"],
                ["B22-2", "D", "Pico", "8464", "1340", "Jose Ferrer"],
                ["B22-8", "L", "Laser", "5040", "1078", "Renato Hidalgo"],
                ["B22-8", "L", "Solo", "5633", "1148", "Andrew Molyneux"],
                ["B22-JC", "D", "Solo", "5524", "1148", "James Channer"],
                ["B22-JC", "D", "Laser", "5569", "1078", "Andrew Molyneux"],
                ["B22-JC", "D", "Solo", "6199", "1148", "Peter Mack"],
                ["B22-JC", "D", "Laser", "5509", "1078", "Jakob Grunig"],
                ["B22-9", "L", "Solo", "4231", "1148", "James Channer"],
                ["B22-9", "L", "Laser", "4255", "1078", "Natalia Nielsen"],
                ["B22-9", "L", "Laser", "4446", "1078", "Michael de Selincourt"],
                ["B22-9", "L", "Laser", "4320", "1078", "Henry Cook"],
                ["B22-9", "L", "Laser", "4183", "1078", "Jakob Grunig"],
                ["B22-9", "L", "Laser", "3581", "1078", "Renato Hidalgo"],
                ["B22-9", "L", "Laser", "4245", "1078", "Tom Glockner"],
                ["B22-3", "D", "Laser", "7298", "1078", "Eleanor Hanning"],
                ["B22-3", "D", "Solo", "7239", "1148", "James Channer"],
                ["B22-3", "D", "Laser", "7820", "1078", "Elaine Agius"],
                ["B22-3", "D", "Solo", "7687", "1148", "Jakob Grunig"],
                ["B22-3", "D", "Solo", "7211", "1148", "Allan Munro-Faure"],
                ["B22-PR", "L", "Solo", "4389", "1148", "James Channer"],
                ["B22-PR", "L", "Laser", "3867", "1078", "Jakob Grunig"],
                ["B22-PR", "L", "Laser", "3942", "1078", "Renato Hidalgo"],
                ["B22-PR", "L", "Laser", "4473", "1078", "Eleanor Hanning"],
                ["B22-PR", "L", "Solo", "4543", "1148", "Brian Clarke rsc"],
                ["B22-PR", "L", "Solo", "4580", "1148", "Gretel Scott rsc"],
                ["B22-PR", "L", "Laser", "4248", "1078", "Alex Hamilton rsc"],
                ["B22-5", "D", "Laser", "8612", "1078", "Henry Cook"],
                ["B22-5", "D", "Enterprise", "9626", "1111", "Karin Andreasson"],
                ["B22-5", "D", "420", "9158", "1100", "Eleanor Hanning"],
                ["B22-5", "D", "Solo", "8610", "1148", "Allan Munro-Faure"],
                ["G22-1", "D", "Laser", "8243", "1078", "Jakob Grunig"],
                ["G22-1", "D", "Solo", "8274", "1148", "Allan Munro-Faure"],
                ["G22-1", "D", "Laser", "8364", "1078", "Henry Cook"],
                ["G22-1", "D", "Solo", "8467", "1148", "Sara Bennett"],
                ["G22-1", "D", "Solo", "8518", "1148", "James Channer"],
                ["G22-1", "D", "Laser", "8693", "1078", "Michael de Selincourt"],
                ["G22-1", "D", "Laser", "8820", "1078", "Andrew Molyneux"],
                ["G22-1", "D", "Laser", "8836", "1078", "Karin Andreasson"],
                ["G22-1", "D", "Laser", "8853", "1078", "Anthony Wort"],
                ["G22-1", "D", "Laser", "9138", "1078", "Hannah Boot"],
                ["G22-1", "D", "Laser", "9325", "1078", "Patrick Hughes"],
                ["G22-1", "D", "Laser", "9436", "1078", "Eleanor Hanning"],
                ["G22-1", "D", "Solo", "9574", "1148", "Peter Mack"],
                ["G22-2", "L", "Laser", "3319", "1078", "Jakob Grunig"],
                ["G22-2", "L", "Laser", "3385", "1078", "Eleanor Hanning"],
                ["G22-2", "L", "Solo", "3472", "1148", "Allan Munro-Faure"],
                ["G22-2", "L", "Laser", "3503", "1078", "Renato Hidalgo"],
                ["G22-2", "L", "Solo", "3684", "1148", "Peter Mack"],
                ["G22-2", "L", "Laser", "3691", "1078", "Sebastian Glen"],
                ["G22-2", "L", "Solo", "3810", "1148", "Sara Bennett"],
                ["G22-2", "L", "GP14", "3944", "1129", "Fleur Stamford"],
                ["G22-2", "L", "Solo", "4072", "1148", "Anthony Wort"],
                ["G22-2", "L", "Enterprise", "4074", "1111", "Jane Deith"],
                ["G22-2", "L", "Laser", "4319", "1078", "Patrick Hughes"],
                ["G22-4", "L", "LaserRadial", "3180", "1111", "James Channer"],
                ["G22-4", "L", "Solo", "3255", "1148", "Peter Mack"],
                ["G22-4", "L", "LaserRadial", "3286", "1111", "Dan Bignold"],
                ["G22-4", "L", "LaserRadial", "3311", "1111", "Henry Cook"],
                ["G22-4", "L", "Solo", "3364", "1148", "Allan Munro-Faure"],
                ["G22-4", "L", "Laser4.7", "3442", "1174", "Patrick Hughes"],
                ["G22-4", "L", "LaserRadial", "3684", "1111", "Jakob Grunig"],
                ["G22-4", "L", "Laser4.7", "4072", "1174", "Elaine Agius"],
                ["G22-5", "D", "Laser", "7116", "1078", "Renato Hidalgo"],
                ["G22-5", "D", "Solo", "7242", "1148", "James Channer"],
                ["G22-5", "D", "Solo", "7256", "1148", "Allan Munro-Faure"],
                ["G22-5", "D", "Solo", "7450", "1148", "Sara Bennett"],
                ["G22-5", "D", "Laser", "7463", "1078", "Eleanor Hanning"],
                ["G22-7", "D", "Solo", "8074", "1148", "Allan Munro-Faure"],
                ["G22-7", "D", "Laser", "8224", "1078", "Peter Mack"],
                ["G22-7", "D", "Laser", "8244", "1078", "Eleanor Hanning"],
                ["G22-7", "D", "Laser", "8440", "1078", "Jacob Grunig"],
                ["G22-7", "D", "Solo", "8657", "1148", "Sebastian Glen"],
                ["G22-7", "D", "Solo", "8686", "1148", "Sara Bennett"],
                ["G22-7", "D", "Laser", "8700", "1078", "Renato Hidalgo"],
                ["G22-8", "L", "Laser", "2982", "1078", "Jacob Grunig"],
                ["G22-8", "L", "Laser4.7", "4068", "1174", "Hannah Boot"],
                ["G22-8", "L", "Solo", "3373", "1148", "Sebastian Glen"],
                ["G22-8", "L", "Solo", "3213", "1148", "James Channer"],
                ["G22-8", "L", "Solo", "3574", "1148", "Allan Munro-Faure"],
                ["G22-9", "L", "Laser", "2874", "1078", "Renato Hidalgo"],
                ["G22-9", "L", "Solo", "2936", "1148", "James Channer"],
                ["G22-10", "L", "Laser", "3919", "1078", "Jonathan Li"],
                ["G22-10", "L", "Laser", "4790", "1078", "Elaine Agius"],
                ["G22-10", "L", "Solo", "3881", "1148", "Allan Munro-Faure"],
                ["G22-11", "L", "LaserRadial", "4260", "1111", "Renato Hidalgo"],
                ["G22-11", "L", "LaserRadial", "4346", "1111", "James Channer"],
                ["C21-1", "L", "Laser", "4758", "1078", "Henry Cook"],
                ["C21-1", "L", "Laser", "4256", "1078", "Renato Hidalgo"],
                ["C21-1", "L", "Laser", "4036", "1078", "Jakob Grunig"],
                ["C21-1", "L", "Laser", "4710", "1078", "Andrew Molyneux"],
                ["C21-1", "L", "Solo", "4619", "1148", "Allan Munro-Faure"],
                ["C21-1.5", "L", "Laser", "5841", "1078", "James Channer"],
                ["C21-1.5", "L", "Laser", "3708", "1078", "Jakob Grunig"],
                ["C21-1.5", "L", "Laser", "2598", "1078", "Renato Hidalgo"],
                ["C21-1.5", "L", "Solo", "4128", "1148", "Allan Munro-Faure"],
                ["C21-2", "L", "Laser", "2520", "1078", "Jakob Grunig"],
                ["C21-2", "L", "Laser", "2794", "1078", "James Channer"],
                ["C21-2", "L", "Laser", "2358", "1078", "Renato Hidalgo"],
                ["C21-2", "L", "Laser", "2878", "1078", "Eleanor Hanning"],
                ["C21-2", "L", "Laser", "3386", "1078", "Madalief Montet"],
                ["C21-2", "L", "LaserRadial", "3598", "1111", "Elaine Agius"],
                ["C21-2", "L", "Solo", "2821", "1148", "Allan Munro-Faure"],
                ["C21-3", "L", "Enterprise", "4524", "1111", "Karin Andreasson"],
                ["C21-3", "L", "Laser", "3595", "1078", "Renato Hidalgo"],
                ["C21-3", "L", "Laser", "5612", "1078", "Gary Marshall"],
                ["C21-3", "L", "Laser", "5490", "1078", "Marco Davanzo"],
                ["C21-3", "L", "Laser", "4458", "1078", "Anthony Wort"],
                ["C21-3", "L", "Laser", "3635", "1078", "Jakob Grunig"],
                ["C21-3", "L", "Laser", "4542", "1078", "Hannah Boot"],
                ["C21-3", "L", "Laser", "3646", "1078", "Andrew Molyneux"],
                ["C21-4", "L", "420NoSpin", "4470", "1120", "Sina Stapelfeldt"],
                ["C21-4", "L", "Laser", "3815", "1078", "James Channer"],
                ["C21-4", "L", "Laser", "3813", "1078", "Jakob Grunig"],
                ["C21-4", "L", "Laser", "3842", "1078", "Henry Cook"],
                ["C21-4", "L", "Laser", "3641", "1078", "Renato Hidalgo"],
                ["C21-4", "L", "LaserRadial", "4104", "1111", "Eleanor Hanning"],
                ["C21-4", "L", "Solo", "4027", "1148", "Peter Mack"],
                ["C21-4", "L", "Solo", "3922", "1148", "Sara Bennett"],
                ["C21-4", "L", "Solo", "3974", "1148", "Allan Munro-Faure"],
                ["C21-5", "L", "Laser", "4600", "1078", "Henry Cook"],
                ["C21-5", "L", "Laser", "4624", "1078", "Jakob Grunig"],
                ["C21-5", "L", "Laser", "4638", "1078", "James Channer"],
                ["C21-5", "L", "Laser", "4676", "1078", "Alan Perfect"],
                ["C21-5", "L", "Laser", "5148", "1078", "Eleanor Hanning"],
                ["C21-5", "L", "Laser", "5236", "1078", "Fleur Stamford"],
                ["C21-5", "L", "Solo", "4680", "1148", "Sara Bennett"],
                ["C21-5", "L", "Solo", "4724", "1148", "Allan Munro-Faure"],
                ["C21-6", "D", "Laser", "4677", "1078", "Alan Perfect"],
                ["C21-6", "D", "Laser", "4513", "1078", "Jakob Grunig"],
                ["C21-6", "D", "Laser", "4630", "1078", "Henry Cook"],
                ["C21-6", "D", "Laser", "4363", "1078", "Renato Hidalgo"],
                ["C21-6", "D", "LaserRadial", "5767", "1111", "Patrick Hughes"],
                ["C21-6", "D", "Supernova", "5261", "1070", "Tom Glockner"],
                ["C21-6", "D", "Solo", "4759", "1148", "Peter Mack"],
                ["C21-7", "L", "Laser4.7", "5442", "1174", "Eleanor Hanning"],
                ["C21-7", "L", "LaserRadial", "3500", "1111", "Renato Hidalgo"],
                ["C21-7", "L", "LaserRadial", "4837", "1111", "John Bengue"],
                ["C21-7", "L", "LaserRadial", "4595", "1111", "Henry Cook"],
                ["C21-7", "L", "LaserRadial", "3507", "1111", "Jakob Grunig"],
                ["C21-7", "L", "MerlinNoSpin", "4488", "1079", "Anthony Wort"],
                ["C21-7", "L", "Solo", "4563", "1148", "Peter Mack"],
                ["C21-8", "D", "420NoSpin", "6589", "1120", "Sina Stapelfeldt"],
                ["C21-8", "D", "Laser", "5496", "1078", "Michael de Selincourt"],
                ["C21-8", "D", "Laser", "5365", "1078", "James Channer"],
                ["C21-8", "D", "Laser", "5297", "1078", "Henry Cook"],
                ["C21-8", "D", "Laser", "5232", "1078", "Renato Hidalgo"],
                ["C21-8", "D", "Solo", "5635", "1148", "Sara Bennett"],
                ["C21-8", "D", "Solo", "5703", "1148", "Peter Mack"],
                ["C21-9", "L", "GP14", "3269", "1129", "Ben Ridgewell"],
                ["C21-9", "L", "Laser4.7", "3340", "1174", "Patrick Hughes"],
                ["C21-9", "L", "Laser4.7", "3307", "1174", "Eleanor Hanning"],
                ["C21-9", "L", "LaserRadial", "2919", "1111", "Henry Cook"],
                ["C21-9", "L", "LaserRadial", "2999", "1111", "Sally Pearce"],
                ["C21-9", "L", "LaserRadial", "3045", "1111", "Michael de Selincourt"],
                ["C21-9", "L", "Solo", "2910", "1148", "James Channer"],
                ["C21-10", "L", "Laser", "3678", "1078", "Eleanor Hanning"],
                ["C21-10", "L", "Laser", "4106", "1078", "Patrick Hughes"],
                ["C21-10", "L", "Laser", "3670", "1078", "Joshua Mareschal"],
                ["C21-10", "L", "Laser", "3950", "1078", "Sebastian Glen"],
                ["C21-10", "L", "Laser", "3671", "1078", "Karin Andreasson"],
                ["C21-10", "L", "Laser", "3634", "1078", "Henry Cook"],
                ["C21-10", "L", "Laser", "3555", "1078", "Renato Hidalgo"],
                ["C21-10", "L", "Solo", "3675", "1148", "Sara Bennett"],
                ["C21-10", "L", "Solo", "3775", "1148", "James Channer"],
                ["C21-10", "L", "Solo", "3661", "1148", "Allan Munro-Faure"],
                ["B21-1", "D", "Solo", "5415", "1148", "Sara Bennett"],
                ["B21-1", "D", "Solo", "5393", "1148", "Peter Mack"],
                ["B21-1", "D", "Laser", "5665", "1078", "Renato Hidalgo"],
                ["B21-1", "D", "Laser", "5729", "1078", "Henry Cook"],
                ["B21-1", "D", "Laser", "5688", "1078", "Jakob Grunig"],
                ["B21-2", "L", "Laser4.7", "4911", "1174", "Eleanor Hanning"],
                ["B21-2", "L", "Laser4.7", "5422", "1174", "Jane Deith"],
                ["B21-2", "L", "LaserRadial", "5176", "1111", "Gary Marshall"],
                ["B21-2", "L", "LaserRadial", "4549", "1111", "Renato Hidalgo"],
                ["B21-2", "L", "Solo", "4881", "1148", "Peter Mack"],
                ["B21-2", "L", "LaserRadial", "4322", "1111", "Henry Cook"],
                ["B21-3", "D", "Laser", "5796", "1078", "James Channer"],
                ["B21-3", "D", "Laser", "5891", "1078", "Jakob Grunig"],
                ["B21-3", "D", "Solo", "6142", "1148", "Peter Mack"],
                ["B21-3", "D", "Laser", "5933", "1078", "Sebastian Glen"],
                ["B21-3", "D", "LaserRadial", "6078", "1111", "Eleanor Hanning"],
                ["B21-3", "D", "Laser", "5747", "1078", "Renato Hidalgo"],
                ["B21-4", "L", "Laser", "2719", "1078", "Jakob Grunig"],
                ["B21-4", "L", "Laser4.7", "3917", "1174", "Elaine Agius"],
                ["B21-4", "L", "Solo", "2787", "1148", "Peter Mack"],
                ["B21-4", "L", "Laser4.7", "3399", "1174", "Eleanor Hanning"],
                ["B21-4", "L", "Laser", "2779", "1078", "Henry Cook"],
                ["B21-4", "L", "Laser", "2556", "1078", "Renato Hidalgo"],
                ["B21-4", "L", "Laser", "2835", "1078", "James Channer"],
                ["B21-4.5", "D", "Laser", "7098", "1078", "John Bengue"],
                ["B21-4.5", "D", "Laser", "6471", "1078", "James Channer"],
                ["B21-4.5", "D", "Laser", "6525", "1078", "Henry Cook"],
                ["B21-4.5", "D", "Laser", "6224", "1078", "Renato Hidalgo"],
                ["B21-4.5", "D", "MerlinNoSpin", "6853", "1079", "Andrew Molyneux"],
                ["B21-4.5", "D", "Solo", "7103", "1148", "Peter Mack"],
                ["B21-4.5", "D", "Laser", "6577", "1078", "Dan Bignold"],
                ["B21-4.5", "D", "Solo", "6703", "1148", "Sebastian Glen"],
                ["B21-4.5", "D", "Laser", "6888", "1078", "Anon1"],
                ["B21-4.5", "D", "Streaker", "6888", "1128", "Christopher Braun"],
                ["B21-5", "L", "Solo", "3173", "1148", "Sara Bennett"],
                ["B21-5", "L", "Solo", "2971", "1148", "Peter Mack"],
                ["B21-5", "L", "Laser", "2640", "1078", "Jakob Grunig"],
                ["B21-5", "L", "Laser", "2797", "1078", "Henry Cook"],
                ["B21-5", "L", "GP14NoSpin", "4113", "1149", "Michael de Selincourt"],
                ["B21-5", "L", "Laser", "3345", "1078", "Christopher Braun"],
                ["B21-6", "L", "Laser", "4734", "1078", "James Channer"],
                ["B21-6", "L", "Laser", "4775", "1078", "Marco Davanzo"],
                ["B21-6", "L", "LaserRadial", "4880", "1111", "Elaine Agius"],
                ["B21-6", "L", "Solo", "4798", "1148", "Sara Bennett"],
                ["B21-6", "L", "Laser", "4116", "1078", "Jakob Grunig"],
                ["B21-6", "L", "Solo", "4153", "1148", "Peter Mack"],
                ["B21-6", "L", "Laser", "4071", "1078", "Renato Hidalgo"],
                ["B21-6", "L", "LaserRadial", "4899", "1111", "Eleanor Hanning"],
                ["B21-6", "L", "Solo", "4837", "1148", "Ranelagh Will Noy"],
                ["B21-6", "L", "Solo", "4802", "1148", "Ranelagh Brian Clarke"],
                ["B21-6", "L", "Laser", "4736", "1078", "Ranelagh Maury Shene"],
                ["B21-6", "L", "Solo", "4702", "1148", "Ranelagh Gretel Scott"],
                ["B21-6", "L", "Laser", "4105", "1078", "Ranelagh Nigel Edwards"],
                ["B21-6", "L", "Laser", "4958", "1078", "Ranelagh Alex Hamilton"],
                ["B21-6", "L", "Solo", "4862", "1148", "Ranelagh Nick Long"],
                ["B21-6", "L", "Laser", "4728", "1078", "Ranelagh Marco Meloni"],
                ["B21-6", "L", "Laser", "4959", "1078", "Ranelagh Richard Westover"],
                ["B21-6", "L", "Laser", "4878", "1078", "Ranelagh Dominic Codera"],
                ["B21-6", "L", "Laser", "4959", "1078", "Ranelagh James Hayward"],
                ["B21-6", "L", "Solo", "4934", "1148", "Ranelagh N. Jacquier"],
                ["B21-6", "L", "Solo", "4870", "1148", "Anon2"],
                ["B21-6", "L", "Laser", "4932", "1078", "Ranelagh Jan Hutchings"],
                ["B21-6.5", "D", "Laser", "4106", "1078", "James Channer"],
                ["B21-6.5", "D", "LaserRadial", "4683", "1111", "Eleanor Hanning"],
                ["B21-6.5", "D", "LaserRadial", "5762", "1111", "Eric Morgan"],
                ["B21-6.5", "D", "LaserRadial", "4843", "1111", "Miles Temp Member"],
                ["B21-6.5", "D", "Solo", "4285", "1148", "Peter Mack"],
                ["B21-7", "L", "Laser", "2800", "1078", "Renato Hidalgo"],
                ["B21-7", "L", "Solo", "3850", "1148", "Sara Bennett"],
                ["B21-7", "L", "Laser", "4515", "1078", "Henry Cook"],
                ["B21-7", "L", "Laser", "2926", "1078", "James Channer"],
                ["B21-7", "L", "Solo", "3210", "1148", "Peter Mack"],
                ["B21-8.5", "D", "Solo", "8376", "1148", "Allan Munro-Faure"],
                ["B21-8.5", "D", "Laser", "9112", "1078", "Elaine Agius"],
                ["B21-8.5", "D", "Laser", "7426", "1078", "James Channer"],
                ["B21-8.5", "D", "Laser", "7249", "1078", "Jakob Grunig"],
                ["B21-8.5", "D", "MerlinNoSpin", "7317", "1079", "Andrew Molyneux"],
                ["B21-8.5", "D", "Solo", "8748", "1148", "Henry Cook"],
                ["B21-8.5", "D", "Solo", "7440", "1148", "Sara Bennett"],
                ["B21-8.5", "D", "Laser", "8994", "1078", "David Barton-Grimley"],
                ["B21-9", "L", "XenonNoSpin", "4806", "1100", "Eric Morgan"],
                ["B21-9", "L", "LaserRadial", "2549", "1111", "Henry Cook"],
                ["B21-9", "L", "Solo", "2725", "1148", "Peter Mack"],
                ["B21-9", "L", "Solo", "2556", "1148", "Allan Munro-Faure"],
                ["B21-10", "L", "Laser", "6501", "1078", "James Fulford"],
                ["B21-10", "L", "Laser", "5243", "1078", "James Channer"],
                ["B21-10", "L", "Solo", "5522", "1148", "Peter Mack"],
                ["B21-10", "L", "Solo", "6366", "1148", "Sara Bennett"],
                ["B21-10", "L", "LaserRadial", "5660", "1111", "Eleanor Hanning"],
                ["B21-11", "L", "Supernova", "4052", "1070", "Sebastian Glen"],
                ["B21-11", "L", "Solo", "4168", "1148", "Peter Mack"],
                ["B21-11", "L", "Xenon", "4832", "1080", "Ben Roost"],
                ["B21-11", "L", "Laser", "3934", "1078", "James Channer"],
                ["B21-11", "L", "Laser", "3712", "1078", "Renato Hidalgo"],
                ["B21-11", "L", "Laser", "3974", "1078", "Henry Cook"],
                ["B21-11", "L", "Laser", "3935", "1078", "Andrew Molyneux"],
                ["B21-12", "D", "Laser", "5085", "1078", "Renato Hidalgo"],
                ["B21-12", "D", "Solo", "6340", "1148", "Sara Bennett"],
                ["B21-12", "D", "LaserRadial", "6808", "1111", "Karin Andreasson"],
                ["B21-12", "D", "LaserRadial", "6775", "1111", "Amaury Baudouin"],
                ["C20-1", "L", "Laser", "3865", "1078", "Andrew Molyneux"],
                ["C20-1", "L", "Laser", "3840", "1078", "Sebastian Glen"],
                ["C20-1", "L", "Laser", "3832", "1078", "Michael de Selincourt"],
                ["C20-1", "L", "Laser", "3678", "1078", "Jakob Grunig"],
                ["C20-1", "L", "Solo", "3818", "1148", "Sara Bennett"],
                ["C20-1", "L", "Solo", "3810", "1148", "Allan Munro-Faure"],
                ["C20-1", "L", "Streaker", "3816", "1128", "James Channer"],
                ["C20-1.5", "D", "Laser", "2640", "1078", "Marc Hare"],
                ["C20-1.5", "D", "Laser", "2227", "1078", "Sally Pearce"],
                ["C20-1.5", "D", "Laser", "2018", "1078", "Andrew Molyneux"],
                ["C20-1.5", "D", "Laser13", "2771", "1135", "Sebastian Glen"],
                ["C20-1.5", "D", "Solo", "2180", "1148", "Peter Mack"],
                ["C20-1.5", "D", "XenonNoSpin", "3907", "1100", "Elaine Agius"],
                ["C20-2", "L", "Laser", "3246", "1078", "Renato Hidalgo"],
                ["C20-2", "L", "Laser", "3388", "1078", "Jakob Grunig"],
                ["C20-2", "L", "Laser", "3651", "1078", "Sally Pearce"],
                ["C20-2", "L", "Laser", "3940", "1078", "James Channer"],
                ["C20-2", "L", "Laser", "3835", "1078", "Anthony Wort"],
                ["C20-2", "L", "Laser", "3701", "1078", "Henry Cook"],
                ["C20-2", "L", "Solo", "3598", "1148", "Allan Munro-Faure"],
                ["C20-2", "L", "Solo", "3584", "1148", "Sara Bennett"],
                ["C20-2", "L", "Solo", "3733", "1148", "Peter Mack"],
                ["C20-2.5", "D", "Laser", "5263", "1078", "Renato Hidalgo"],
                ["C20-2.5", "D", "Laser", "5302", "1078", "Jakob Grunig"],
                ["C20-2.5", "D", "Laser", "5405", "1078", "Henry Cook"],
                ["C20-2.5", "D", "Laser", "5890", "1078", "Michael de Selincourt"],
                ["C20-2.5", "D", "Solo", "6538", "1148", "Peter Mack"],
                ["C20-2.5", "D", "Solo", "6566", "1148", "Sara Bennett"],
                ["C20-2.5", "D", "Laser", "6215", "1078", "Andrew Molyneux"],
                ["C20-3", "L", "LaserRadial", "3600", "1111", "Renato Hidalgo"],
                ["C20-3", "L", "LaserRadial", "4500", "1111", "Jakob Grunig"],
                ["C20-4", "L", "Laser", "5393", "1078", "Michael de Selincourt"],
                ["C20-4", "L", "Laser", "4612", "1078", "Renato Hidalgo"],
                ["C20-4", "L", "Laser", "5509", "1078", "Peter Mack"],
                ["C20-4", "L", "Laser", "5096", "1078", "Andrew Molyneux"],
                ["C20-4", "L", "LaserRadial", "5575", "1111", "James Channer"],
                ["C20-4", "L", "LaserRadial", "5132", "1111", "Sally Pearce"],
                ["C20-5", "L", "LaserRadial", "3026", "1111", "Henry Cook"],
                ["C20-5", "L", "LaserRadial", "3450", "1111", "James Channer"],
                ["C20-5", "L", "LaserRadial", "3454", "1111", "Peter Mack"],
                ["C20-5", "L", "LaserRadial", "3594", "1111", "Renato Hidalgo"]]

            var columns = {
                "id": 0,
                "raceType": 1,
                "boatClass": 2,
                "elapsed": 3,
                "officialPy": 4,
                "helm": 5,
                "corrected": 6
            }

            var classWins = {}
            var classEntries = {} 
            sailorSkillHandicaps = []

            console.log("Structuring data (inefficiently)...")

            var races = {}

            results.forEach(seperateRaces)

            function seperateRaces(row) {
                raceId = row[columns.id]
                raceType = row[columns.raceType]
                raceTypeSelectValue = document.getElementById("raceTypeSelect").value
                // If this race is not of the required type, skip it
                if(raceTypeSelectValue != "*"){
                    //console.log("Checking race filter " + raceType + ", " + raceTypeSelectValue)
                    if (raceType != raceTypeSelectValue) {
                        //console.log("Skipping irrelevant race")
                        return 
                    }
                }

                // If this result is for a race that doesn't exist, create an empty race
                if(!races[raceId]) {
                    races[raceId] = []
                }

                //console.log("Adding a result to race " + raceId)
                races[raceId].push(row)
            }

            console.log("Races are:")
            console.log(races)

            console.log("Reading form and editing PYs...")

            // Read the PYs the user has entered into the "PYs" array
            for (const [bc, py] of Object.entries(PYs)) {
               PYs[bc] = parseInt(document.getElementById(bc).value) 
            }

            //console.log(PYs)

            console.log("Applying handicaps to all the races...")
            for (const [id, r] of Object.entries(races)) {
                handicapRace(races[id]) // Handicap a race (which is an array of results)
            }

            function handicapRace(race) {
                race.forEach(correctTime) // Append a corrected time to each result in the race
            }

            // Calculates a new corrected time for a race result and append it as the last element in the array
            function correctTime(row) {
                // If (there IS a PY available for this result)
                if(PYs[row[columns.boatClass]]) {
                    // Correct the time
                    //console.log("Correcting time for " + row[columns.helm] + "'s " + row[columns.boatClass] + " in race " + row[columns.id])
                    //console.log("elapsed is " + row[columns.elapsed])
                    //console.log("PY is " + PYs[row[columns.boatClass]])

                    var corrected = row[columns.elapsed] * 1000 / PYs[row[columns.boatClass]]
                    //console.log("corrected = " + corrected)

                    corrected = Math.round(corrected) 
                    row.push(corrected) // Write the corrected time onto the end of the row
                }
                else
                {
                    alert("CANNOT FIND PY FOR CLASS " + row[columns.boatClass])
                    throw new Error("Cannot proceed without a PY for this class")
                }
            }

            console.log("Sorting by corrected times")
            // Sort each race by corrected times
            for (const [id, r] of Object.entries(races)) {
               sortRace(races[id]) 
            }

            function sortRace(race) {
                //console.log("Sorting a race...")
                race.sort(function(a,b) {
                    return a[columns.corrected] - b[columns.corrected];
                })
            }

            // console.log(races)

            console.log("Analysing new results...")
            
            // Analyse each race
            for (const [id, r] of Object.entries(races)) {
                analyseSortedRace(races[id])
            }

            function analyseSortedRace(race) {

                console.log("=====ANALYSING SORTED RACE=====")
                
                if(race[0]) { // Only process non-empty races!
                    
                    // CLASS ANALYSIS

                    // Credit the participation to the boat class for boat win %ages
                    raceClasses = []
                    
                    // Populate a local list raceClasses of classes that competed at all
                    race.forEach(addClass)

                    function addClass(row) {
                        c = row[columns.boatClass]
                        if(raceClasses.indexOf(c) === -1) { raceClasses.push(c) }
                    }

                    if(raceClasses.length < 2) { 
                        console.log("Not crediting class entry because it's a single class race")
                        //console.error("Single class race in data")
                    }
                    else
                    {
                        // Credit the win ( race[0] ) to the boat class for boat win %ages
                        firstPlace = race[0]
                        boatClass = firstPlace[columns.boatClass]
                        if(!classWins[boatClass]) 
                            { classWins[boatClass] = 1 } 
                        else 
                            { classWins[boatClass] = classWins[boatClass] + 1}

                        // Credit the classes with those entries
                        raceClasses.forEach(creditClassEntry)
                        
                        // Calculate the new entries for the boat class
                        function creditClassEntry(e) {
                            if(!classEntries[e]) { classEntries[e] = 1} else { classEntries[e] += 1}
                        }
                    }

                    // SAILOR ANALYSIS ==============================================

                    // Calculate average result per class
                    
                    classCorrectedResults = []

                    race.forEach(compileClassResults)

                    // Add this results to the classResults
                    function compileClassResults(row){
                        

                        if(classCorrectedResults[row[columns.boatClass]])
                        {
                            classCorrectedResults[row[columns.boatClass]].push(row[columns.corrected])
                        }
                        else
                        {
                            classCorrectedResults[row[columns.boatClass]] = [row[columns.corrected]]
                        }
                    }

                    //console.log(classCorrectedResults) // e.g. ["Laser":[1234,5678]...]

                    // Calculate race class mean averages
                    classAverageCorrectedResults = []

                    // For each list of corrected results OF MORE THAN 1 RESULT, calculate an average
                    for (const [bc, ctsArray] of Object.entries(classCorrectedResults)) {
                        
                        if(ctsArray.length < 2)
                        {
                            console.log("Too few " + bc + "s to compare")
                        }
                        else
                        {
                            sum = 0
                            count = 0
                            
							//console.log("For class " + bc + "...")
							
                            ctsArray.forEach(function(ct){
                                //console.log("Accounting for result " + ct + "...")
                                sum += ct
                                count += 1
                            })

                            classAverageCorrectedResults[bc] = Math.round(sum/count,0)
                        }
                    }

                    console.log("classAverageCorrectedResults is:")
                    console.log(classAverageCorrectedResults)

                    // Calculate race-level sailor skill factors
                    race.forEach(calculateSailorSkill)

                    function calculateSailorSkill(row) {

                        if(classAverageCorrectedResults[row[columns.boatClass]]) {
                            skill = row[columns.corrected] / classAverageCorrectedResults[row[columns.boatClass]]
                            skill = Math.round(skill * 1000,0)
                        
                            //console.log(row[columns.helm] + " deserves personal handicap " + skill + " when sailing " + row[columns.boatClass])

                            if(sailorSkillHandicaps[row[columns.helm]]) {
                                //console.log("Appending " + row[columns.helm] + " with " + skill)
                                sailorSkillHandicaps[row[columns.helm]].push(skill)
                            }
                            else
                            {
                                //console.log("Initialising " + row[columns.helm] + " with " + skill)
                                sailorSkillHandicaps[row[columns.helm]] = [skill]
                            }

                        }
                        else
                        {
                            console.log("No " + row[columns.boatClass] + " entry") // No entry for the class, presumably for good reasons
                        }
                    }
					

                } // End of per-race analysis
                else
                {
                    console.warn("Empty race found!")
                }

                //console.log(sailorSkillHandicaps)

            }
            
            // RACE ANALYSIS COMPLETE

            sailorSkillAverages = []

			// Reduce the lists of skill scores into a single mean average per sailor
            for (const [sailor, rArray] of Object.entries(sailorSkillHandicaps)) {
                    
                //console.log("For sailor " + sailor + "...")
                sum = 0
                count = 0
                
                rArray.forEach(function(r){
                    //console.log("Accounting for result " + ct + "...")
                    sum += r
                    count += 1
                })

                sailorSkillAverages[sailor] = Math.round(sum/count,0)
            }
			
			console.log(sailorSkillAverages)
            
            //console.log(classWins)
            //console.log(classEntries)

            console.log("Summarising results")

            html = "<table>"
            //html += "<th>Class</th> <th>Wins</th> <th>Entered</th> <th>Handicap</th>"

            sortedPYs = Object.entries(RYAPYs).sort()
            
            classEntriesArray = Object.entries(classEntries)
            classEntriesArray.sort()

            for (const [bc, py] of sortedPYs) {
                if(!classWins[bc]){classWins[bc] = 0} // Overwrite undefined wins with zero
                if(!classEntries[bc]){classEntries[bc] = 0} // Overwrite undefined entries with zero
                
                // Prepare a statement on whether the PY was altered
                var altered = " (club)"
                if (PYs[bc] != clubPYs[bc]) { altered = " (altered from club "+ clubPYs[bc] +")"} else {  }
                e = classEntries[bc]

                // Prepare the win %
                var percent
                if (classWins[bc] == 0 && classEntries[bc] == 0) { // catch 0/0 which is NaN
                    percent = ""
                }
                else
                {
                    percent = "(" + Math.round((classWins[bc] / e) * 100) + "% - " + (Math.round(((classWins[bc] + 1) / e) * 100) - 1) + "%)"
                }

                // Assemble the output
                if (percent == "")
                {
                    var message = "<td>" + bc + "</td>"
                }
                else
                {
                    var message = ("<td>" + bc + "</td><td>would have won " + classWins[bc] + "</td><td>of " + e + "</td><td> " + percent + " multiclass races with handicap " + PYs[bc] + "</td><td>" + altered + "</td>")
                }

                html += "<tr>" + message + "</tr>"
            }

            html += "</table>"

            html += "<h2>Full simulation</h2>"

            html += "<p>The three numbers shown are: actual seconds, handicap, and corrected seconds.</p>"

            html += "<p>" 
                
            // Write out the entire simulation
            for (const [id, r] of Object.entries(races)) {
                races[id].forEach(function(row) { 
                        html += row + "<br/>"
                })
            }                

            html += "</p>"

            document.getElementById("summary").innerHTML = html            

        }

    </script>
	
</body>
</html>